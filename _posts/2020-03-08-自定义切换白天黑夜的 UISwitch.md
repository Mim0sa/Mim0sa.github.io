---
title: è‡ªå®šä¹‰åˆ‡æ¢ç™½å¤©é»‘å¤œçš„ UISwitch
tags: ["iOS", "ç¬”è®°"]
---

### å‰è¨€

å‰æ®µæ—¶é—´åœ¨åšè‡ªå·± App é€‚é… Dark Mode çš„æ—¶å€™çœ‹åˆ°äº†ä¸€ä¸ª[Procreateçš„åŠ¨ç”»æ•™ç¨‹](https://www.bilibili.com/video/av82589461)ä»¥åŠè¯¥è§†é¢‘ç®€ä»‹ä¸­çš„çµæ„Ÿæ¥æºï¼Œè§‰å¾—è¿˜æŒºæœ‰æ„æ€çš„ï¼Œæƒ³ç€~~å¤æ‚çš„ä¸œè¥¿æˆ‘åšä¸å‡ºæ¥åšä¸ªè¿™ä¸ªæ€»å¯ä»¥å§å˜¿å˜¿å˜¿~~ï¼Œäºæ˜¯å‡†å¤‡ä»¿ç…§é£æ ¼ç€æ‰‹å®ç°ä¸€ä¸‹ã€‚ä¸‹å›¾æˆ‘å®ç°çš„æ•ˆæœï¼Œå·¦è¾¹æ˜¯ç™½å¤©ï¼Œå³è¾¹æ˜¯é»‘å¤œã€‚

<!--more-->

![Demo of DNSwitch](/resouces/demoOfDNSwitch.png)

### è°ƒç ”

æˆ‘å…ˆçœ‹äº†ä¸€ä¸‹åŸç”Ÿçš„UISwitchçš„åŠŸèƒ½ï¼Œå¤§è‡´æ˜¯è¿™æ ·çš„ï¼š

```swift
var isOn: Bool
// A Boolean value that determines the off/on state of the switch.

func setOn(Bool, animated: Bool)
// Set the state of the switch to On or Off, optionally animating the transition.

var onTintColor: UIColor?
// The color used to tint the appearance of the switch when it is turned on.

var thumbTintColor: UIColor?
// The color used to tint the appearance of the thumb.
```

åä¸¤ä¸ªå±æ€§å¯¹åº”çš„æ˜¯ UISwitch åœ¨ On çŠ¶æ€ä¸‹çš„èƒŒæ™¯é¢œè‰²å’Œ UISwitch ä¸­é—´çš„åœ†å½¢æœºå…³é¢œè‰²ï¼Œé‚£åœ¨æˆ‘çš„è¿™ä¸ªæ§ä»¶é‡Œæ²¡æœ‰è¿™ä¸ªéœ€æ±‚ï¼Œæ‰€ä»¥æˆ‘å°±ä¸å¼€æ”¾è¿™ä¸¤ä¸ªå±æ€§äº†ã€‚

`setOn(Bool, animated: Bool)` è¿™ä¸ªæ–¹æ³•å¯ä»¥æ›´æ”¹å½“å‰ UISwitch çš„å¼€å…³çŠ¶æ€ï¼Œå¹¶ä¸”å¯ä»¥è¾“å…¥ `animated` å‚æ•°æ¥å†³å®šåšä¸åšåŠ¨ç”»ã€‚è·å– `isOn` è¿™ä¸ªå±æ€§å¯ä»¥è·å¾—æ˜¯ UISwitch å½“å‰çš„å¼€å…³çŠ¶æ€ï¼Œæ›´æ”¹è¿™ä¸ªå±æ€§ä¼šæ‰§è¡Œä¸€æ¬¡ç±»ä¼¼æ²¡æœ‰åŠ¨ç”»çš„ `setOn(Bool, animated: Bool)` æ–¹æ³•ã€‚

### å¼€å§‹è½

å¼€å§‹å†™ä»£ç çš„æ—¶å€™ï¼Œæˆ‘~~ä¸å‡æ€ç´¢çš„~~é€‰æ‹©äº† UIView å’Œ UIImageView æ¥ä½œä¸ºå®ç°æ–¹å¼ã€‚æˆ‘çš„æƒ³æ³•æ˜¯é€šè¿‡æ”¾ç½®ä¸€å¼ å¤§çº¦ä¸¤å€æ ‡å‡† UISwitch å®½åº¦çš„é•¿å›¾ï¼Œå’Œé€šè¿‡è®¾ç½® `clipsToBounds = true` æ¥å®Œæˆå›¾ç‰‡çš„éƒ¨åˆ†æ»‘åŠ¨ã€‚

åŸç”Ÿ UISwitch çš„å°ºå¯¸æ˜¯ `(width: 51, height: 31)`, å¹¶ä¸”è™½ç„¶ UISwitch å¯ä»¥é€šè¿‡ `init(frame: CGRect) ` æ¥åˆå§‹åŒ–ä½†å®½åº¦å’Œé«˜åº¦çš„è®¾ç½®æ˜¯æ— æ•ˆçš„ã€‚

![Content Image](resouces/switchImg.png)

![Layer Detail](resouces/On_Layer.png)

è½çš„è¿‡ç¨‹æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œé¦–å…ˆæ˜¯æœ€åº•ä¸‹ UIView çš„åˆå§‹åŒ–æ–¹æ³•å’Œè®¾ç½®åœ†è§’å’Œåˆ‡å‰²ï¼š

```swift
class DNSwitch: UIView {
    init(withSystemSizeOn position: CGPoint, image: UIImage) {
        super.init(frame: CGRect(x: position.x - DNSwitch.width / 2,
                                 y: position.y - DNSwitch.height / 2,
                                 width: DNSwitch.width, height: DNSwitch.height))
        
        clipsToBounds = true
        layer.cornerRadius = frame.height / 2
    }
}
```

```Swift
extension DNSwitch {
    static let width: CGFloat = 51
    static let height: CGFloat = 31
    
    static let offset: CGFloat = 2
}
```

æ¥ä¸‹æ¥æ˜¯é€šè¿‡ä¼ å…¥çš„ UIImage æ¥åˆ›å»ºåˆé€‚çš„ UIImageViewï¼Œå› ä¸ºæ€•ä¼ è¿›æ¥çš„å›¾ç‰‡æ¯”å¼€å…³æœ¬èº«è¿˜è¦å°ï¼Œæ‰€ä»¥åšäº†ä¸ªåˆ¤æ–­ã€‚å¦å¤–æˆ‘è¿™é‡Œæ˜¯åœ¨åˆå§‹åŒ–æ—¶å°±ä¼ å…¥äº†å›¾ç‰‡ï¼Œæ‰€ä»¥è¿™ä¸ªå‡½æ•°å°±åªè§¦å‘ä¸€æ¬¡ã€‚å¦‚æœæŠŠ image åšæˆå¼€å…³çš„ä¸€ä¸ªå±æ€§ï¼Œåœ¨åˆå§‹åŒ–ä¹‹åå¯ä»¥è‡ªå·±é€‰æ‹©æ—¶æœºä¼ å…¥å›¾ç‰‡çš„è¯ï¼Œä¹Ÿå¯ä»¥æŠŠè¿™ä¸ªæ–¹æ³•æ”¹å†™æˆä¸€ä¸ª `updateImage(image: UIImage)` çš„æ›´æ–° image çš„æ–¹æ³•ï¼Œå°±æ˜¯è¦æ³¨æ„åœ¨ update çš„æ—¶å€™å½“å‰å¼€å…³çš„çŠ¶æ€æ˜¯ On è¿˜æ˜¯ Offã€‚

```swift
private func configureImageView(image: UIImage) {
    let ratio = image.size.height / frame.height
    let imgWidth = image.size.width / ratio
    imageView.frame.size = CGSize(width: imgWidth > frame.width ? imgWidth : frame.width, height: frame.height)
    imageView.frame.origin = CGPoint(x: imgWidth > frame.width ? frame.width - imgWidth : 0, y: 0)
    imageView.image = image
    addSubview(imageView)
}
```
é…ç½®åœ†å½¢æœºå…³çš„å±æ€§å’Œè®¾ç½®ç‚¹å‡»æ‰‹åŠ¿ã€‚è¿™é‡Œçš„ `DNSwitch.offset` æ˜¯æŒ‡åœ†å½¢æœºå…³å’Œå¼€å…³ä¹‹é—´é—´éš™çš„è·ç¦»ã€‚

```swift
private func configureThumbView() {
    thumbView.frame = CGRect(x: DNSwitch.offset, y: DNSwitch.offset,
                             width: frame.height - DNSwitch.offset * 2,
                             height: frame.height - DNSwitch.offset * 2)
    thumbView.backgroundColor = .white
    thumbView.layer.cornerRadius = thumbView.frame.height / 2
    
    thumbView.layer.shadowOffset = CGSize(width: 0, height: 1)
    thumbView.layer.shadowColor = UIColor.black.cgColor
    thumbView.layer.shadowRadius = DNSwitch.offset
    thumbView.layer.shadowOpacity = 0.5
    addSubview(thumbView)
}

private func prepareGestureRecognizer() {
    tapGestureRecognizer.addTarget(self, action: #selector(tap(gesture:)))
    addGestureRecognizer(tapGestureRecognizer)
}

@objc private func tap(gesture: UITapGestureRecognizer) {
    if gesture.state == .ended {
        setOn(!isOn, animated: true)
    }
}
```

æ¥ä¸‹æ¥æ˜¯å…³äº `setOn(Bool, animated: Bool)` çš„æ–¹æ³•ï¼Œæˆ‘åœ¨ç±»ä¸­æ”¾äº†ä¸€ä¸ª `hasAnimate` æ¥å­˜æ”¾æ˜¯å¦æ‰§è¡ŒåŠ¨ç”»ã€‚

```swift
private var hasAnimate: Bool = false

func setOn(_ isOn:Bool, animated: Bool) {
    hasAnimate = animated
    if self.isOn != isOn {
        self.isOn = isOn
    }
}
```

åœ¨æ¯æ¬¡ `isOn` æ›´æ”¹æ—¶ï¼Œä¼šæ ¹æ®å½“å‰çš„ `hasAnimate` å’Œ `isOn` æ¥è¿›è¡ŒåŠ¨ç”»çš„å‘ç”Ÿã€‚

```swift
var isOn: Bool = false { didSet { animate() } }

private func animate() {
    if hasAnimate {
        UIView.animate(withDuration: 0.15, animations: {
            self.updateFrame()
        }) { (finish) in
            self.hasAnimate = false
        }
    } else {
        updateFrame()
    }
}

private func updateFrame() {
    if isOn {
        imageView.frame.origin = CGPoint(x: 0, y: 0)
        thumbView.frame.origin = CGPoint(x: frame.width - thumbView.frame.width - DNSwitch.offset, y: DNSwitch.offset)
    } else {
        imageView.frame.origin = CGPoint(x: frame.width - imageView.frame.width, y: 0)
        thumbView.frame.origin = CGPoint(x: DNSwitch.offset, y: DNSwitch.offset)
    }
}
```

ç„¶åæ‰¾ä¸ªåœ°æ–¹æŠŠè¿™ä¸ªå¼€å…³æ·»åŠ åˆ°å±å¹•ä¸Šå°±å¯ä»¥äº†ï¼Œè¿™é‡Œçš„ `"switchImg"` å°±æ˜¯æˆ‘ä¸Šæ–‡çš„é‚£å¼ é•¿å›¾ã€‚

```swift
let position = CGPoint(x: view.center.x, y: view.center.y)
let dnSwitch = DNSwitch(withSystemSizeOn: position, image: UIImage(named: "switchImg"))
view.addSubview(dnSwitch)
```

![Gif Demo](resouces/DNSwitchGif.gif)

### è½å®Œä¹‹å

çœ‹åˆ°è¿™é‡Œä½ å¯èƒ½æœ‰ä¸€è‚šå­ç–‘æƒ‘ï¼Œæ¯”å¦‚ï¼š

* é—®ï¼šä½ è¿™ä¸ªå¼€å…³ä¸ºä»€ä¹ˆä¸ç”¨ `UIControl` æ¥å®ç°ï¼Œè€Œæ˜¯ç”¨ `UIView` + `UITapGestureRecognizer` æ¥å®ç°ï¼Ÿ
    * ~~ç›²ç”Ÿï¼Œä½ å‘ç°äº†åç‚¹~~ï¼Œæ˜¯æˆ‘çš„é”…ï¼Œæˆ‘å†™åˆ°è¿™æ‰æ„è¯†åˆ°äº‹æƒ…çš„ä¸å¯¹åŠ²ï¼Œ~~ä½†æ˜¯ä¸æƒ³å†å¼„äº†~~ã€‚
    * `UIControl` æœ‰ `addTarget(Any?, action: Selector, for: UIControl.Event)` ä»¥åŠ ` sendAction(Selector, to: Any?, for: UIEvent?)` æ–¹æ³•ä¹Ÿèƒ½å¾ˆå¥½çš„å¤„ç†è¿™ç±»æƒ…å†µã€‚
* é—®ï¼šä¸ºä»€ä¹ˆä½ æ˜¯ç”¨ä¸€å¼ é•¿å›¾ï¼Œè€Œä¸æ˜¯ä¸¤å¼ å„è‡ªé£æ ¼çš„å›¾ï¼Ÿ
    * æ˜¯è¿™æ ·ï¼Œæˆ‘æœ¬ä»¥ä¸ºä¸¤å¼ å„è‡ªé£æ ¼çš„å›¾ä¼šæ˜¾å¾—å¾ˆçªå…€ï¼Œä½†å®é™…ä¸Šç”±äºåœ†å½¢ç™½è‰²æœºå…³çš„å­˜åœ¨ä¼šæŒ¡ä½ä¸€å¤§éƒ¨åˆ†å›¾ï¼Œæ‰€ä»¥ä½¿ç”¨ä¸¤å¼ å„è‡ªé£æ ¼çš„å›¾æ•ˆæœåº”è¯¥ä¹Ÿä¸é”™ï¼Œå¹¶ä¸”å¯æ§åˆ¶çš„èŒƒå›´ä¹Ÿä¼šæ›´å¤§ä¸€äº›ã€‚
* é—®ï¼šåŸç”Ÿçš„èƒ½åŠ é˜´å½±ï¼Œä½ è®¾ç½®äº† `clipsToBounds = true` ï¼Œé‚£ä½ è¦åŠ é˜´å½±ä¸å°±éº»çƒ¦äº†ï¼Ÿ
    * å¯¹çš„ï¼Œæ‰€ä»¥æˆ‘æ²¡åŠ é˜´å½±ã€‚
* é—®ï¼šä½ ä¸ºä»€ä¹ˆå«ä»–ç™½è‰²æœºå…³ï¼Ÿ
    * å«æŒ‰é’®ä¸åˆé€‚ï¼Œæˆ‘ä¸çŸ¥é“è¯¥å«ä»–ä»€ä¹ˆã€‚
* é—®ï¼šä½ è¿™ç™½å¤©çœ‹èµ·æ¥ä¹Ÿåƒé»‘å¤œå•Šï¼Ÿ
    * æˆ‘è§‰å¾—åƒç™½å¤©å•Šï¼Ÿä¸åƒä¹ˆï¼Ÿ

![å¯è¾¾é¸­çœ‰å¤´ä¸€çš±](resouces/å¯è¾¾é¸­çœ‰å¤´ä¸€çš±.jpg)

### æ€»ç»“ä¸€ä¸‹

* å‰æœŸçš„è°ƒç ”éå¸¸ä¸åˆ°ä½ã€‚
* å†åšè¿™ç§è§¦ç¢°å¼çš„æ§ä»¶ä¸ç”¨ `UIControl` æˆ‘å°±æ˜¯ğŸ¶ã€‚
* æ¼æ´ç™¾å‡ºã€‚

å…¶å®åšè¿™ä¸ª Demo åªèŠ±äº† 1 å°æ—¶ï¼Œå†™è¿™ç¯‡ç¬”è®°èŠ±äº†å¤§åŠå¤©ï¼Œä¸»è¦çš„ç›®çš„è¿˜æ˜¯å¸Œæœ›è‡ªå·±èƒ½å¤Ÿå…»æˆè®°å½•çš„ä¹ æƒ¯ï¼Œæ‰€ä»¥æ‰æ²¡æœ‰æŠŠè¿™ç¯‡æ–‡ç äº†ğŸ˜ã€‚